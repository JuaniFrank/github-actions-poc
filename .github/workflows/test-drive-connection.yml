name: Test Google Drive Connection

on:
  workflow_dispatch:
    # Permitir ejecuciÃ³n manual
    inputs:
      folder_id:
        description: 'Google Drive Folder ID (opcional)'
        required: false
        type: string

jobs:
  test-drive:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install pnpm
        uses: pnpm/action-setup@v4
        with:
          version: latest

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'pnpm'

      - name: Install dependencies
        run: pnpm install --frozen-lockfile

      - name: Create .env file
        run: |
          echo "GOOGLE_DRIVE_CREDENTIALS=$(echo ${{ secrets.GOOGLE_DRIVE_CREDENTIALS_B64 }} | base64 --decode)" > .env
          echo "GOOGLE_DRIVE_FOLDER_ID=${{ github.event.inputs.folder_id || secrets.GOOGLE_DRIVE_FOLDER_ID || '' }}" >> .env

      - name: Compile TypeScript
        run: pnpm exec tsc -p tsconfig.node.json

      - name: Test Google Drive Connection
        run: node dist/scripts/test-drive-connection.js

      - name: Test Results
        if: always()
        run: |
          echo "âœ… Test completado"
          echo "ðŸ“Š Revisa los logs arriba para ver los resultados"
